# Открытый аппаратный гео-трекер

Мобильное автономное устройство на базе контроллера STM-32, GPS\Глонасс-приёмника и LORA-модуля связи.
Предназначено для отслеживания треков членов групп на пестности, а также для передачи коротких текстовых и статцсных сообщений.

## Возможности:

* Обмен между всеми агентам группы координатами своего местоположения.
* Передача и синзронизация по mesh-сети между всеми агентами помимо текущих координат ещё и цепочек трека каждого агента.
* Отображение диспозиции группировки агентов на экране устройства в виде схематического векторного представления.
* Отображение на экране устройства перечня Агентов группы, их координат и статусов.
* Отображение на экране qr-кода со геометкой в виде ссылки на карту для смартфона.
* Предлагаются для передачи пакеты следующих типов в порядке понижения приоритета:
  1. текущие координаты
  2. статусы (теги статусов, которыми можно подать условные сигналы внутри группы, выразить намерения, обозначить новый маршрут и т.д., также через них передаётся уровень заряда батареи, температура, длительность неактивности по акселерометру и прочее)
код статуса (уникальный идентификатор, помимо стандартных можно создавать свои кастомные)
параметры (уровень заряда батареи, число спутников, сколько примерно времени прибор не шевелили, номер POI места следования) 
  3. новые POI, созданные другими агентами группы (идентификатор с префиксом автора, имя, тип)
  4. фрагменты своего трека
  5. комментарии к POI и Статусам (id, таймштамп обновления, текст)
  6. проксируемые по цепочке Агентам группы, пакеты
  7. подтверждения о доставке пакетов
  8. пакет настроек групповой mesh-сети

* У каждого типа пакета есть TTL (время актуальности). У текущих координат оно около 1, то есть их не требуется пытаться передать проксирующими пакетами более одного раза без подтверждения.
* У статусных пакетов TTL обычно выше и может настраиваться, то есть статусы мы стараемся доставить до невидящих нас Агентов более настойчиво.
Когда координаты "шевелятся" в рамках диаметра пятна точности, можно уменьшить частоту их отправки, и\или отправлять дифференциальные значения относительно предыдущих показаний.
С некоторой периодичностью отправлять и реперные полные координаты.
* Слабо изменяющиеся координаты можно отправлять реже. При большей скорости движения можно передавать координаты чаще.
* Эфир делится на слоты. Срочные пакеты отправляются в отдельных группах слотов, для отправки менее приоритетных пакетов
Агенты пользуются слотами низкоприоритетных пакетов захватывая их согласно своих потребностей: числа и приоритета пакетов, которые нужно разослать.

## Дополнительные сооборажения

Наверно я в пунктах выше изобрёл какой-то "велосипед", который уже реализован в mesh-сетях, тогда стоит использовать стандартные протоколы, конечно.

Описанный подход позволит реализовать действительно продвинутый групповой трекер, который будет лучше работать на границах видимости, позволит растягивать группу на расстояния, превышающие дистанцию видимости, позволит поднимать ноды-ретрансляторы, которые практически не будут слать в эфир свои координаты и статусы (потому что те не меняются), зато будут постоянно проксировать пакеты между отдельными "островами" агентов.

Пакеты в срочных слотах и несрочных должны отправляться по одному и тому же принципу, просто к срочным гораздо выше требования по компактности пакета, там применяются дифференциальные сжатия данных между пакетами, динамическое уменьшение точности передачи данных в зависимости от точности сигнала от GPS. Нет смысла с максимальной точностью передавать координаты, определённые до сотни метров. Малые изменения координат можно отправлять вектором относительного смещения. Это даст мало информации об оперативном перемещении Агентам которые вас плохо "слышат", но таким агентам информация поступать всё же будет, но по цепочке mesh-сети.

Агент отсылает свой пакет в слоте с некоторой вероятностью, которую вычисляет в зависимости от загруженности сети. В загруженной сети Агенты смогут вставлять свои пакеты, хотя и реже, не в каждую периодическую группу слотов. То же касается и несрочных пакетов.
Ответные пакеты с подтверждениями о доставке группируются, чтобы не флудить в эфире.  Срочные пакеты не требуют отдельного подтверждения о доставке. Вместо этого время от времени каждый Агент шлёт несрочный пакет с информацией кого и когда он "видел" в последний раз. Это позволит мониторить связность сети.

Очень здорово было бы через UART иметь возможность передавать все принятые пакеты по bluetotth в приложение на смартфоне. Также через UART реализовать простой интерфейс управления трекером: обновление настроек, редактирование списка POI, изменение статусов, редактирование комментариев к POI...

В таком виде систему трекинга можно было бы применять в смешанных распределенных группах переменной связности. Протокол можно сделать более менее стабильным, а алгоритмы подбора вероятностей для отправки тех или иных пакетов уже отдать на откуп прошивкам и тонким настройкам.

Лично мне очень хотелось бы реализовать такую систему для групповых путешествий, чтобы каждого члена семьи было не только видно в реальном времени, но и можно было отследить где и когда его последний раз "видела" вся сеть. На автомобилях группы можно устанавливать более мощные ноды, которые могли бы релизовывать синхронизацию отложенных статусных и текстовых сообщений. Так даже при отсутствии мелкоячеестой связи при наличии ретрансляторной ноды где-то на скале с солнечной батареей, можно оставлять сообщения, которые будут не терять актуальность месяцами. Например можно оставить в таком виде журнал посещения сторожки.

Такой протокол также, позволил бы реализовать передачу сообщений, треков, POI с описаниями и статусов с так называемой "оказией", когда не связанные группы туристов со стандартизованными устройствами могли бы попутно переносить в памяти своих устройств своеобразную "почту" для удалённых групп. Также такую почту можно было бы пересылать и на дальние расстояния по коротковолновой связи. Например в горах ретрансляторные модули можно было бы ставить с дополнительным коротковолновым модулем для связи с "большой землёй".

Было бы здорово такому проекту претендовать на открытый стандарт для двусторонней пейджинговой связи и гео-трекинга малых групп в туризме и не только. 
